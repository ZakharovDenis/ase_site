{% extends "static/static_files/html/ase_wrap.html" %}

{% load staticfiles %}
{% block header %}
<link rel="stylesheet" href="{% static 'css/buttons.css'%}" type="text/css">
<link rel="stylesheet" href="{% static 'css/form-style.css'%}" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
<script type="text/javascript">
  function map_init(map) {
    var pointList =[];
    {% for coord in coord_list %}
      pointList.push(new L.LatLng({{coord.0}}, {{coord.1}}));
    {% endfor %}
    // var pointA = new L.LatLng(51.673860, 35.605450);
    // var pointB = new L.LatLng(51.662703, 35.507791)
    // var pointList = [pointA, pointB];
    var polyline = new L.polyline(pointList, {
      color: "blue",
      weight: 3,
      opacity: 0.5,
      smoothFactor: 1
    });
    map.setView(pointList[0], 12);
    polyline.addTo(map)
  
    // L.marker([lon, lat]).addTo(map);
  }
  $(document).ready(function () {
    $(".request____delete_me____").click(function (e) {
      var mapdiv = $('td.right')
      if (mapdiv.is(':visible')) {
        mapdiv.hide();
      } else {
        mapdiv.show();
      }
      // var kkk = "{\n \"id_gps\": "+$(this).attr("id");
      // alert(kkk);
      $.ajax({
        type: 'POST',
        url: '/geo/get',
        contentType: "application/json;",
        dataType: "json",
        // data: {
        data: "{\n \"id_gps\": " + $(this).attr("id") + '}',
        // csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        // },
        success: function (json) {
          map_init(map = mapdiv.find($('main')), lat = json[0].fields.latitude, lon = json[0].fields.longitude)
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {

        }
      })
    })
  });
</script>
<style>
  .leaflet-container {
    /* all maps */
    width: 100%;
    height: 100%;
    z-index: 0;
    /* display: none; */
  }
</style>
{% endblock %}
{% block content %}
{% load leaflet_tags %}
{% leaflet_css %}
{% leaflet_js %}

<body>
  <table class="container">
    <tr>
      <td class="left">
        <table>
          {% for line in application %}
          <tr>
            <th>{{line.0}}</th>
            <td>{{line.1}}</td>
          </tr>
          {% endfor %}
        </table>
      </td>
      <td class="right">
        {% if app.status == 3 %}
        <h2 class="text-info">Запрос {{app.id}}</h2>
        <p>{{sendrequest.delivery|safe|linebreaks}}</p>
        <div class=".leaflet-container">
          {% leaflet_map "main" callback="map_init" %}
        </div>
        {% endif %}
      </td>
    </tr>
  </table>
  {% if not user.level == 1 %}
  <a href="approve/" class="btnyes left">Подтвердить запрос</a>
  <a href="disapprove/" class="btnno left">Отклонить запрос</a>
  {% endif %}
  <a href="print" class="btnreg left">Сохранить WORD</a>
</body>
{% endblock %}